name: Issue Implementation Planner

on:
  issues:
    types: [opened]

jobs:
  plan-implementation:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Generate implementation plan with Claude
        id: claude
        uses: anthropics/claude-code-action@beta
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          direct_prompt: |
            A new issue has been opened in this repository. Please analyze it and provide an implementation plan.

            ## Issue #${{ github.event.issue.number }}: ${{ github.event.issue.title }}

            ${{ github.event.issue.body }}

            ---

            Please provide:
            1. A brief summary of what this issue is requesting
            2. Key files that would likely need to be modified (based on the codebase structure)
            3. A step-by-step implementation plan
            4. Any potential challenges or considerations
            5. Estimated complexity (Low/Medium/High)

            Format your response in clear markdown. Be specific about file paths and code changes where possible.
          allowed_tools: "Read,Glob,Grep"
          max_turns: "10"

      - name: Post implementation plan as comment
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            ## Implementation Plan

            ${{ steps.claude.outputs.response }}

            ---
            *This plan was automatically generated by Claude. Please review and adjust as needed.*
